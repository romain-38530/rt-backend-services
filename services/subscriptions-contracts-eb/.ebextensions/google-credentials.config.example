# ==============================================================================
# AWS Elastic Beanstalk Configuration - Google Cloud Credentials
# ==============================================================================
# Ce fichier configure les credentials Google Cloud Vision API pour l'OCR fallback
#
# Instructions:
# 1. Copiez ce fichier vers: .ebextensions/google-credentials.config
# 2. Remplacez les valeurs VOTRE_* par vos vraies valeurs
# 3. NE COMMITEZ PAS le fichier .config avec de vraies valeurs dans Git!
# 4. Ajoutez .ebextensions/*.config au .gitignore (sauf *.config.example)
#
# ==============================================================================

files:
  "/var/app/current/google-credentials.json":
    mode: "000400"
    owner: webapp
    group: webapp
    content: |
      {
        "type": "service_account",
        "project_id": "VOTRE_PROJECT_ID",
        "private_key_id": "VOTRE_PRIVATE_KEY_ID",
        "private_key": "-----BEGIN PRIVATE KEY-----\nVOTRE_PRIVATE_KEY_ICI\n-----END PRIVATE KEY-----\n",
        "client_email": "VOTRE_SERVICE_ACCOUNT@VOTRE_PROJECT.iam.gserviceaccount.com",
        "client_id": "VOTRE_CLIENT_ID",
        "auth_uri": "https://accounts.google.com/o/oauth2/auth",
        "token_uri": "https://oauth2.googleapis.com/token",
        "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
        "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/VOTRE_SERVICE_ACCOUNT%40VOTRE_PROJECT.iam.gserviceaccount.com"
      }

# ==============================================================================
# Alternative: Stocker les credentials dans AWS Secrets Manager
# ==============================================================================
# Pour plus de sécurité, stockez les credentials dans AWS Secrets Manager
# et utilisez un script pour les récupérer au démarrage
#
# commands:
#   01_get_google_credentials:
#     command: |
#       aws secretsmanager get-secret-value \
#         --secret-id rt-symphonia/google-vision-credentials \
#         --query SecretString \
#         --output text > /var/app/current/google-credentials.json
#       chmod 400 /var/app/current/google-credentials.json
#       chown webapp:webapp /var/app/current/google-credentials.json
#
# ==============================================================================

# Security: Ensure the file is not world-readable
container_commands:
  01_secure_google_credentials:
    command: |
      if [ -f /var/app/current/google-credentials.json ]; then
        chmod 400 /var/app/current/google-credentials.json
        chown webapp:webapp /var/app/current/google-credentials.json
        echo "Google credentials secured"
      else
        echo "Warning: Google credentials file not found"
      fi
